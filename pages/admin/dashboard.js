
import {useEffect,useState} from 'react'; import Header from '../../components/Header';
export default function Dashboard(){ const [user,setUser]=useState(null); const [activity,setActivity]=useState([]); const [start,setStart]=useState(''); const [end,setEnd]=useState('');
useEffect(()=>{ try{ setUser(JSON.parse(localStorage.getItem('qaid_user')));}catch(e){} fetch('/api/activity').then(r=>r.json()).then(d=>setActivity(d.activity||[])); },[]);
function logout(){ localStorage.removeItem('qaid_user'); location.href='/admin/login'; }
function downloadCsv(type){ const params = new URLSearchParams(); if(start) params.set('start', start); if(end) params.set('end', end); if(user) params.set('user', user.username); window.location.href = `/api/export?type=${encodeURIComponent(type)}&${params.toString()}`; }
return (<div><Header/><main className='p-8 max-w-6xl mx-auto'><div className='flex justify-between items-center'><h1 className='text-2xl font-bold'>Admin Dashboard</h1><div><button onClick={logout} className='btn-primary'>Logout</button></div></div><div className='mt-6 card'><h3 className='font-semibold'>User: {user? user.username: 'Not logged in'} {user && `(${user.role})`}</h3>{user && user.role==='Manager' ? (<div className='mt-4'><h4 className='font-semibold'>Export Data (CSV)</h4><div className='mt-2 flex gap-2 items-center'><label className='text-sm'>Start</label><input type='date' value={start} onChange={e=>setStart(e.target.value)} className='p-2'/><label className='text-sm'>End</label><input type='date' value={end} onChange={e=>setEnd(e.target.value)} className='p-2'/></div><div className='flex flex-wrap gap-2 mt-3'><button className='btn-outline px-3 py-1' onClick={()=>downloadCsv('orders')}>Export Orders</button><button className='btn-outline px-3 py-1' onClick={()=>downloadCsv('contacts')}>Export Contacts</button><button className='btn-outline px-3 py-1' onClick={()=>downloadCsv('maintenance')}>Export Maintenance</button><button className='btn-outline px-3 py-1' onClick={()=>downloadCsv('insurance')}>Export Insurance</button><button className='btn-outline px-3 py-1' onClick={()=>downloadCsv('ads')}>Export Ad Requests</button><button className='btn-outline px-3 py-1' onClick={()=>downloadCsv('activity')}>Export Activity</button><button className='btn-outline px-3 py-1' onClick={()=>downloadCsv('kiosks')}>Export Kiosks</button></div><div className='mt-3 text-sm text-gray-400'>CSV will download automatically and an activity entry will be recorded for the export.</div></div>) : (<div className='mt-4 text-gray-400'>Activity log visible only to Manager.</div>)}{user && user.role==='Manager' ? (<div className='mt-4'><h4 className='font-semibold'>Activity Log</h4>{activity.length===0? <div className='text-gray-400'>No activity yet.</div> : activity.slice().reverse().map(a=>(<div key={a.id} className='border-b py-2'><div><strong>{a.user}</strong> â€” {a.action}</div><div className='text-sm text-gray-500'>{new Date(a.ts).toLocaleString()}</div></div>))}</div>) : null}</div></main></div>); }
